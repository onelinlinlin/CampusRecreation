<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap-table.min.css"/>
    <script src="/LoginRegister/js/jquery.js" type="text/javascript"></script>
    <script src="/bootstrap/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/bootstrap/js/bootstrap-table.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/bootstrap/js/bootstrap-table-zh-CN.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/bootstrap/js/sweetalert.min.js" type="text/javascript" charset="utf-8"></script>

    <style>
        #bread { margin-top: 5px;}
        #musicmanage {text-align: center; color: #122b40;}
        thead tr .th-inner {text-align: center;}
    </style>

    <script>
        $(function () {

            $('#table').bootstrapTable({
                url:"/music/findallmusic2",
                method: 'post',             //请求方式（*）
                locale: "zh-CN",            // 语言
                dataType:"json",
                contentType: "application/x-www-form-urlencoded",
                toolbar: "#toolbar",        // 工具栏
                search: true,              // 显示搜索
                showColumns: false,         //隐藏列
                striped: true,              // 是否显示行间隔色
                showRefresh: true,         // 是否显示刷新按钮
                clickToSelect: false,       // 是否启用点击选中行
                pageList: [3, 4, 5],        //可供选择的每页的行数（*）
                showToggle: false,          // 是否显示详细视图和列表视图的切换按钮
                sortable: true,            // 是否启用排序
                sortOrder: "asc",           // 排序方式
                pagination: true,           // 是否显示分页
                pageSize: "3",              // 每页显示的行数
                pageNumber:"1",               //当前第几页
                sidePagination: "client",   // 分页方式：client客户端分页，server服务端分页
                columns: [
                    { field: 'musicid', title: '音乐', sortable: true},
                    {
                        field: 'musicprc',
                        title: '音乐封面',
                        sortable: true,
                        formatter: function (value,row,index) {
                            var result = "";

                            if (value == "") {
                                result = "<span style='color: orangered;'>未上传图片</spansty>";
                            } else {
                                result = "<img src='/prc/musicprc/"+value+".jpg' alt='找不到图片' style='width: 68px;100px;'/>";
                            }
                            return result;
                        }
                    },
                    { field: 'musicname', title: '音乐名称', sortable: true},
                    { field: 'singer', title: '歌手', sortable: true},
                    {
                        field: 'recommend',
                        title: '音乐状态',
                        formatter: function (value,row,index) {
                            var result = "";
                            if (value == "是") {
                                result += '<span style="color: #99CC66">已推荐</span>';
                            } else {
                                result += '<span style="color: orangered">未推荐</span>';
                            }
                            return result;
                        }
                    },
                    {
                        field: 'operate',
                        title: '操作',
                        align: 'center',
                        valign: 'middle',
                        events: {
                            'click #isrecommend': function (e, value, row, index) {
                                musicrec(row.musicid,"是");
                            },
                            'click #norecommend': function (e, value, row, index) {
                                musicrec(row.musicid,"否");
                            }
                        },
                        formatter: function (value, row, index) {
                            var result = "";

                            if (row.recommend == "是") {
                                result += '<button id="norecommend" class="btn btn-danger">取消推荐</button>';
                            } else {
                                result += '<button id="isrecommend" class="btn btn-info">设为推荐</button>';
                            }
                            return result;
                        }
                    }
                ]
            });

            //设置推荐
            function musicrec(musicid,recommend) {
                $.ajax({
                    url: "/music/setMusicrecommend",
                    type:"post",
                    data:{
                        "recommend":recommend,
                        "musicid":musicid
                    },
                    success: function (data) {

                        if (data === "操作成功") {
                            if (recommend === "否") {

                                swal({
                                    title: "提示",
                                    text: "成功取消推荐",
                                    icon: "success",
                                    showConfirmButton: true
                                });

                                $('#table').bootstrapTable('refresh');
                            } else {

                                swal({
                                    title: "提示",
                                    text: "成功设为推荐",
                                    icon: "success",
                                    showConfirmButton: true
                                });

                                $('#table').bootstrapTable('refresh');
                            }
                        }
                    }
                })
            }

        });
    </script>

</head>

<body>

<div id="mainbody">

    <!--面包屑导航开始-->
    <ul class="breadcrumb" id="bread">当前位置：
        <li>后台管理</li>
        <li>首页推荐管理</li>
        <li>音乐推荐</li>
    </ul>

    <div class="page-header" id="musicmanage">
        <h3>音乐推荐</h3>
    </div>

    <!--表格-->
    <div style="text-align: center;">
        <div id="toolbar"></div>
        <table id="table"  style="text-align: center;"></table>
    </div>
    <!--表格结束-->

</div>


</body>

</html>




